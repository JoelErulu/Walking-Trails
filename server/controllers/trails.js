import mongoose from 'mongoose';
import TrailDetail from '../models/trail.js';

export const initializeTrails = async () => {
    const trails = [{
        name: 'Gold Trail',
        path: {
            type: 'LineString',
            coordinates: [
                [-84.00527240759934, 33.9804327949268],
                [-84.005425507664, 33.980353575203154],
                [-84.00544404063348, 33.980258836069275],
                [-84.00553638697316, 33.98023130998688],
                [-84.00566859407513, 33.98031233583348],
                [-84.00606229109326, 33.98051662236481],
                [-84.00627567949988, 33.980541303381045],
                [-84.00636015238378, 33.98062901854693],
                [-84.0070998429049, 33.980620836245514],
                [-84.00705874453666, 33.98047780686156],
                [-84.0072731823203, 33.9791752438593],
                [-84.00668813314094, 33.97931036346966],
                [-84.00607101155583, 33.97946727517414],
                [-84.00514918039732, 33.97949233613153],
                [-84.00453550335115, 33.97979936335503],
                [-84.00413565828339, 33.979476117422834],
                [-84.00127106165904, 33.980763982534704],
                [-84.0011749064003, 33.98067195835729],
                [-84.00080383673247, 33.980967592954045],
                [-84.00059883287396, 33.981652803992205],
                [-84.00086143665311, 33.98250797424149],
                [-84.00113798492909, 33.982456440666276],
                [-84.00118626469136, 33.982909372483],
                [-84.00296987076443, 33.983034372243324],
                [-84.00380743472242, 33.98277545927202],
                [-84.00516753107239, 33.982119348167465],
                [-84.00436201390548, 33.9808875669128],
                [-84.00527240759934, 33.9804327949268]
            ]
        }
    },{
        name: 'Gray Trail',
        path: {
            type: 'LineString',
            coordinates: [
                [-83.99934638811425, 33.97967560437334],
                [-83.99999280048684, 33.97960640398059],
                [-84.00018860174492, 33.97949631233059],
                [-84.00095841674242, 33.98059256585612],
                [-84.00083503512774, 33.980658620011404],
                [-84.00091013698015, 33.98082532788936],
                [-84.0005864416191, 33.98148318828498],
                [-84.00087524617379, 33.98249386952536],
                [-84.00113810265725, 33.98243410753451],
                [-84.0013168374316, 33.982728725675095],
                [-84.00287788307827, 33.982904865548576],
                [-84.00292884504955, 33.98316907467445],
                [-84.0028507798253, 33.98333519504798],
                [-84.00405994589548, 33.984200411263295],
                [-84.00480422695614, 33.98443784080755],
                [-84.00525056815857, 33.98468876206725],
                [-84.0049863705706, 33.985462498805724],
                [-84.00375870998322, 33.98516275445264],
                [-84.0039651099732, 33.984491313350226],
                [-84.00514982841312, 33.98479011112938],
                [-84.00517535436221, 33.984718906196086],
                [-84.00473866684281, 33.984479862685],
                [-84.00402519924485, 33.98424082005488],
                [-84.0037086985811, 33.984033229856976],
                [-84.00352730698141, 33.98386399339135],
                [-84.0028364621154, 33.983393560887336],
                [-84.00279191095645, 33.98304470109728],
                [-84.00227023197125, 33.98302169262648],
                [-84.00121054359171, 33.982884187922664],
                [-84.00103796590041, 33.98306839827867],
                [-84.00053822218693, 33.98341136240258],
                [-83.99831153137256, 33.98019843191301],
                [-83.99934638811425, 33.97967560437334]
            ]
        }
    },{
        name: 'Green Trail',
        path: {
            type: 'LineString',
            coordinates: [
                [-84.00006969125516, 33.97809098899297],
                [-84.00301387572847, 33.97758629354619],
                [-84.00408138735254, 33.979310787281094],
                [-84.00400062888367, 33.9793709406993],
                [-84.00454296954817, 33.9798257240277],
                [-84.00515024881724, 33.97948750866205],
                [-84.00606444823453, 33.97947719314045],
                [-84.00727684826602, 33.97917484775735],
                [-84.00930292478986, 33.97939071628647],
                [-84.01020958125805, 33.979188813845546],
                [-84.01030054892523, 33.97901494111879],
                [-84.01042929495794, 33.977662367267115],
                [-84.01193964705985, 33.97776428264252],
                [-84.01201937346033, 33.977877450156726],
                [-84.01192013172678, 33.979138801396935],
                [-84.0106159450226, 33.97910203519382],
                [-84.01055385649103, 33.97894771267771],
                [-84.01042293939832, 33.97895089459389],
                [-84.01039477620367, 33.97906727793773],
                [-84.01049933624462, 33.979174730342315],
                [-84.01047956602821, 33.979273806621364],
                [-84.01157386327976, 33.97948404867353],
                [-84.01171065593952, 33.97970423186272],
                [-84.01166938621931, 33.97976712648228],
                [-84.01063134533894, 33.98044865426362],
                [-84.0097913121089, 33.980809382702496],
                [-84.00914090857894, 33.98078425174301],
                [-84.00722926630057, 33.98061001161156],
                [-84.00672184217707, 33.980831511007125],
                [-84.00579916227595, 33.9816744816242],
                [-84.00565039830704, 33.981735841661425],
                [-84.00573488789101, 33.981814476497135],
                [-84.00343875445816, 33.982960032232526],
                [-84.00287445574696, 33.98306100345038],
                [-84.00285019746674, 33.98334647866549],
                [-84.00365964159394, 33.98386792054119],
                [-84.00405994589548, 33.984200411263295],
                [-84.00480422695614, 33.98443784080755],
                [-84.00525056815857, 33.98468876206725],
                [-84.0049863705706, 33.985462498805724],
                [-84.00375870998322, 33.98516275445264],
                [-84.0039651099732, 33.984491313350226],
                [-84.00514982841312, 33.98479011112938],
                [-84.00517535436221, 33.984718906196086],
                [-84.00473866684281, 33.984479862685],
                [-84.00402519924485, 33.98424082005488],
                [-84.0037086985811, 33.984033229856976],
                [-84.00352730698141, 33.98386399339135],
                [-84.0028364621154, 33.983393560887336],
                [-84.00279191095645, 33.98304470109728],
                [-84.00227023197125, 33.98302169262648],
                [-84.00121054359171, 33.982884187922664],
                [-84.00103796590041, 33.98306839827867],
                [-84.00053822218693, 33.98341136240258],
                [-83.99764503234873, 33.97927322465532],
                [-84.00006969125516, 33.97809098899297]
            ]
        }
    }
    ];
    try {
        await TrailDetail.deleteMany();
        await TrailDetail.insertMany(trails);
        console.log('Trails initialized successfully');
    } catch (error) {
        console.error('Failed to initialize trails:', error);
    }
};

export const getTrails = async (req, res) => {
    try {
        const trails = await TrailDetail.find();
        res.status(200).json(trails);
    } catch (error) {
        res.status(404).json({ message: error.message });
    }
};

export const createTrail = async (req, res) => {
    const trail = req.body;
    const newTrail = new TrailDetail(trail);
    try {
        await newTrail.save();
        res.status(201).json(newTrail);
    } catch (error) {
        res.status(409).json({ message: error.message });
    }
};

export const updateTrail = async (req, res) => {
    const { id: _id } = req.params;
    const trail = req.body;

    if (!mongoose.Types.ObjectId.isValid(_id)) return res.status(404).send(`No trail with id: ${_id}`);

    const updatedTrail = await TrailDetail.findByIdAndUpdate(_id, trail, { new: true });
    res.json(updatedTrail);
};

export const deleteTrail = async (req, res) => {
    const { id } = req.params;

    if (!mongoose.Types.ObjectId.isValid(id)) return res.status(404).send(`No trail with id: ${id}`);

    await TrailDetail.findByIdAndRemove(id);
    res.json({ message: "Trail deleted successfully." });
};
